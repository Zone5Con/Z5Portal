{
  "Name": "CFS-LOX",
  "HttpMethod": "POST",
  "IsEnabled": true,
  "OrderIndex": 0,
  "CrossDomainPolicy": "Public",
  "Inputs": [],
  "Actions": [
    {
      "ActionType": "ParseJsonIntoTokens",
      "OrderIndex": 0,
      "Parameters": {
        "JsonString": "[RawInput]",
        "BaseTokenName": "CFS"
      },
      "IsEnabled": true,
      "ExecutionType": "OnExecute",
      "Metadata": {}
    },
    {
      "Description": "Check Borrower Cell Phone Number",
      "ActionType": "RunSql",
      "OrderIndex": 1,
      "Condition": "[CFS:BorCellPhone] != \"\"",
      "Parameters": {
        "ConnectionString": "",
        "QueryTimeout": "",
        "SqlQuery": "SELECT CASE\n                 WHEN [CFS:BorCellPhone] LIKE CONCAT('[23456789]', REPLICATE('[0123456789]', 9))\n                      AND [CFS:BorCellPhone] LIKE CONCAT('%[^', LEFT([CFS:BorCellPhone], 1), ']%')\n                   THEN 'yes'\n                 ELSE 'no' \n               END",
        "BindTokens": "",
        "OutputTokenName": "BorValid",
        "ExtractColumns": "",
        "OnError": [],
        "ShowErrors": false
      },
      "IsEnabled": true,
      "ExecutionType": "OnExecute",
      "Metadata": {}
    },
    {
      "Description": "Check Co-Borrower Cell Phone Number",
      "ActionType": "RunSql",
      "OrderIndex": 2,
      "Condition": "false",
      "Parameters": {
        "ConnectionString": "",
        "QueryTimeout": "",
        "SqlQuery": "SELECT CASE\n                 WHEN [CFS:CobCellPhone] LIKE CONCAT('[23456789]', REPLICATE('[0123456789]', 9))\n                      AND [CFS:CobCellPhone] LIKE CONCAT('%[^', LEFT([CFS:CobCellPhone], 1), ']%')\n                   THEN 'yes'\n                 ELSE 'no' \n               END",
        "BindTokens": "",
        "OutputTokenName": "CobValid",
        "ExtractColumns": "",
        "OnError": [],
        "ShowErrors": false
      },
      "IsEnabled": true,
      "ExecutionType": "OnExecute",
      "Metadata": {}
    },
    {
      "Description": "Bor CellPhone must be valid",
      "ActionType": "RawResponse",
      "OrderIndex": 3,
      "Condition": "[BorValid] == \"no\"",
      "Parameters": {
        "Content": "{\n    \"error\": \"The BorCellPhone parameter is not a valid phone number\"\n}",
        "HttpCode": "",
        "Headers": [
          {
            "value": "application/json",
            "name": "ContentType"
          }
        ]
      },
      "IsEnabled": true,
      "ExecutionType": "OnExecute",
      "Metadata": {}
    },
    {
      "Description": "Cob CellPhone must be valid",
      "ActionType": "RawResponse",
      "OrderIndex": 4,
      "Condition": "false",
      "Parameters": {
        "Content": "{\n    \"error\": \"The CobCellPhone parameter is not a valid phone number\"\n}",
        "HttpCode": "",
        "Headers": [
          {
            "value": "application/json",
            "name": "ContentType"
          }
        ]
      },
      "IsEnabled": true,
      "ExecutionType": "OnExecute",
      "Metadata": {}
    },
    {
      "Description": "BorEmail Cannot be blank",
      "ActionType": "RawResponse",
      "OrderIndex": 5,
      "Condition": "[CFS:BorEmail] == \"\"",
      "Parameters": {
        "Content": "{\n    \"error\": \"The BorEmail parameter cannot be blank\"\n}",
        "HttpCode": "",
        "Headers": [
          {
            "value": "application/json",
            "name": "ContentType"
          }
        ]
      },
      "IsEnabled": true,
      "ExecutionType": "OnExecute",
      "Metadata": {}
    },
    {
      "Description": "CobEmail Cannot be blank",
      "ActionType": "RawResponse",
      "OrderIndex": 6,
      "Condition": "false",
      "Parameters": {
        "Content": "{\n    \"error\": \"The BorEmail parameter cannot be blank\"\n}",
        "HttpCode": "",
        "Headers": [
          {
            "value": "application/json",
            "name": "ContentType"
          }
        ]
      },
      "IsEnabled": true,
      "ExecutionType": "OnExecute",
      "Metadata": {}
    },
    {
      "Description": "Loan Number Cannot be blank",
      "ActionType": "RawResponse",
      "OrderIndex": 7,
      "Condition": "[CFS:LoanNumber] == \"\"",
      "Parameters": {
        "Content": "{\n    \"error\": \"The LoanNumber parameter cannot be blank\"\n}",
        "HttpCode": "",
        "Headers": [
          {
            "value": "application/json",
            "name": "ContentType"
          }
        ]
      },
      "IsEnabled": true,
      "ExecutionType": "OnExecute",
      "Metadata": {}
    },
    {
      "Description": "Delivery Email Cannot be blank",
      "ActionType": "RawResponse",
      "OrderIndex": 8,
      "Condition": "[CFS:DeliveryEmail] == \"\"",
      "Parameters": {
        "Content": "{\n    \"error\": \"The DeliveryEmail parameter cannot be blank\"\n}",
        "HttpCode": "",
        "Headers": [
          {
            "value": "application/json",
            "name": "ContentType"
          }
        ]
      },
      "IsEnabled": true,
      "ExecutionType": "OnExecute",
      "Metadata": {}
    },
    {
      "Description": "First Name Cannot be blank",
      "ActionType": "RawResponse",
      "OrderIndex": 9,
      "Condition": "[CFS:FirstName] == \"\"",
      "Parameters": {
        "Content": "{\n    \"error\": \"The First Name parameter cannot be blank\"\n}",
        "HttpCode": "",
        "Headers": [
          {
            "value": "application/json",
            "name": "ContentType"
          }
        ]
      },
      "IsEnabled": true,
      "ExecutionType": "OnExecute",
      "Metadata": {}
    },
    {
      "Description": "CellPhone Cannot be blank",
      "ActionType": "RawResponse",
      "OrderIndex": 10,
      "Condition": "[CFS:BorCellPhone] == \"\"",
      "Parameters": {
        "Content": "{\n    \"error\": \"The BorCellPhone parameter cannot be blank\"\n}",
        "HttpCode": "",
        "Headers": [
          {
            "value": "application/json",
            "name": "ContentType"
          }
        ]
      },
      "IsEnabled": true,
      "ExecutionType": "OnExecute",
      "Metadata": {}
    },
    {
      "Description": "Subject Prop Cannot be blank",
      "ActionType": "RawResponse",
      "OrderIndex": 11,
      "Condition": "[CFS:SubjectProp] == \"\"",
      "Parameters": {
        "Content": "{\n    \"error\": \"The SubjectProp parameter cannot be blank\"\n}",
        "HttpCode": "",
        "Headers": [
          {
            "value": "application/json",
            "name": "ContentType"
          }
        ]
      },
      "IsEnabled": true,
      "ExecutionType": "OnExecute",
      "Metadata": {}
    },
    {
      "Description": "SubjCity Cannot be blank",
      "ActionType": "RawResponse",
      "OrderIndex": 12,
      "Condition": "[CFS:SubjectCity] == \"\"",
      "Parameters": {
        "Content": "{\n    \"error\": \"The SujectCity parameter cannot be blank\"\n}",
        "HttpCode": "",
        "Headers": [
          {
            "value": "application/json",
            "name": "ContentType"
          }
        ]
      },
      "IsEnabled": true,
      "ExecutionType": "OnExecute",
      "Metadata": {}
    },
    {
      "Description": "FirstName Cannot be blank",
      "ActionType": "RawResponse",
      "OrderIndex": 13,
      "Condition": "[CFS:FirstName] == \"\"",
      "Parameters": {
        "Content": "{\n    \"error\": \"The FirstName parameter cannot be blank\"\n}",
        "HttpCode": "",
        "Headers": [
          {
            "value": "application/json",
            "name": "ContentType"
          }
        ]
      },
      "IsEnabled": true,
      "ExecutionType": "OnExecute",
      "Metadata": {}
    },
    {
      "Description": "LastName Cannot be blank",
      "ActionType": "RawResponse",
      "OrderIndex": 14,
      "Condition": "[CFS:LastName] == \"\"",
      "Parameters": {
        "Content": "{\n    \"error\": \"The LastName parameter cannot be blank\"\n}",
        "HttpCode": "",
        "Headers": [
          {
            "value": "application/json",
            "name": "ContentType"
          }
        ]
      },
      "IsEnabled": true,
      "ExecutionType": "OnExecute",
      "Metadata": {}
    },
    {
      "ActionType": "LoadUser",
      "OrderIndex": 15,
      "Parameters": {
        "Id": "craig@goz5.com",
        "Portal": ""
      },
      "IsEnabled": true,
      "ExecutionType": "OnExecute",
      "Metadata": {}
    },
    {
      "ActionType": "PlantAnApp.CreateEntity.0.LOX",
      "OrderIndex": 16,
      "Parameters": {
        "ConnectionString": "",
        "LoanGuid": "[CFS:LoanGuid]",
        "LoanNumber": "[CFS:LoanNumber]",
        "FirstName": "[CFS:FirstName]",
        "LastName": "[CFS:LastName]",
        "LOXExplanation": "[CFS:LOXExplantation]",
        "SubjectProp": "[CFS:SubjectProp]",
        "SubjectCity": "[CFS:SubjectCity]",
        "SubjectState": "[CFS:SubjectState]",
        "SubjectZip": "[CFS:SubjectZip]",
        "DeliveryEmail": "[CFS:DeliveryEmail]",
        "BorEmail": "[CFS:BorEmail]",
        "CobEmail": "[CFS:CobEmail]",
        "BorCellPhone": "[CFS:BorCellPhone]",
        "CobCellPhone": "[CFS:CobCellPhone]",
        "OutputToken": ""
      },
      "IsEnabled": true,
      "ExecutionType": "OnExecute",
      "Metadata": {}
    },
    {
      "ActionType": "SendMail",
      "OrderIndex": 17,
      "Condition": "",
      "Parameters": {
        "From": "",
        "To": "[CFS:BorEmail]",
        "DetermineEmail": "",
        "ToAllUsers": "",
        "ReplyTo": "",
        "Cc": "",
        "Bcc": "",
        "Subject": "Chicago Financial Mortgage - Document Request",
        "Format": {
          "Expression": "",
          "Value": "Html",
          "IsExpression": false,
          "Parameters": {}
        },
        "DnnEmailTemplate": {
          "Expression": "",
          "Value": "",
          "IsExpression": false,
          "Parameters": {}
        },
        "Body": "<!-- [if mso]>\n  <center>\n  <table><tr><td width=\"640\">\n  <![endif]-->\n\n\n\n<div style=\"max-width: 640px; margin: 0 auto;\"><br>\n<table style=\"max-width: 640px; width: 100%;\" border=\"0\" width=\"640\" cellspacing=\"0\" cellpadding=\"0\" bgcolor=\"#FFFFFF\">\n<tbody>\n<tr>\n<td style=\"padding-left: 25px; padding-top: 20px; text-align: left;\" width=\"320\"><a href=\"https://cfsmortgage.com\"> <img style=\"margin: 0; padding: 0; border: none; display: block;\" src=\"https://z5portal.com/Portals/0/Images/cfs-white-transp-logo-final.jpg\" alt=\"Chicage Financial\" width=\"250\" height=\"45\" border=\"0\"></a></td>\n</tr>\n</tbody>\n</table>\n<table style=\"max-width: 640px; width: 100%; text-align: center;\" border=\"0\" width=\"640\" cellspacing=\"0\" cellpadding=\"0\" bgcolor=\"#FFFFFF\">\n<tbody>\n<tr>\n<td style=\"padding: 0 26px; max-width: 600px; text-align: top;\" width=\"600\"><hr></td>\n</tr>\n</tbody>\n</table>\n<table style=\"max-width: 640px; width: 100%; text-align: center;\" border=\"0\" width=\"640\" cellspacing=\"0\" cellpadding=\"0\" bgcolor=\"#FFFFFF\">\n<tbody>\n<tr>\n<td style=\"padding: 0; text-align: top;\">\n<table style=\"width: 85%; margin: auto; padding-bottom: 22px;\">\n<tbody>\n<tr>\n<td style=\"text-align: center; color: #00adef; padding-top: 10px; padding-bottom: 15px; font-family: sans-serif; font-size: 24px; line-height: 26px; font-weight: normal;\"><span style=\"color: #003366;\"><strong>Document Review &amp; Signature</strong></span></td>\n</tr>\n<tr>\n<td style=\"text-align: left; color: #111; font-family: sans-serif; font-size: 16px; line-height: 20px; font-weight: normal; padding-bottom: 10px;\">&nbsp;</td>\n</tr>\n<tr>\n<td style=\"text-align: left; color: #111; font-family: sans-serif; font-size: 16px; line-height: 25px; font-weight: normal;\">\n<p>Hi [CFS:FirstName],</p>\n<p>The following Letter of Explanation is needed to be reviewed and signed by you.&nbsp; Please click on the button below to be redirected to our secured online portal.</p>\n</td>\n</tr>\n<tr>\n<td style=\"text-align: left; color: #752828; font-family: sans-serif; font-size: 18px; line-height: 20px;\">\n<p style=\"text-align: center;\"><span style=\"padding-left: 10px;\">&nbsp;</span></p>\n</td>\n</tr>\n<tr>\n<td style=\"padding: 14px; text-align: center;\"><a href=\"https://z5portal.com/LOX-Sig?LG=[CFS:LoanGuid]\" target=\"_blank\" rel=\"noopener\"><img src=\"https://z5portal.com/Portals/0/Images/ReviewSign.PNG\" alt=\"ReviewSign\" width=\"250px\" height=\"60px\"></a></td>\n</tr>\n<tr>\n<td style=\"text-align: left; color: #111; font-family: sans-serif; font-size: 16px; line-height: 20px; font-weight: normal; padding-bottom: 10px;\">\n<p>&nbsp;</p>\n<p>If you have any questions please reach out to Sally Williams at 803-207-9208<br><br></p>\n</td>\n</tr>\n<tr>\n<td style=\"text-align: left; color: #111; font-family: sans-serif; font-size: 16px; line-height: 20px; font-weight: normal; padding-bottom: 10px;\"><strong>Thank you for being a Chicago Financial Customer.</strong></td>\n</tr>\n<tr>\n<td class=\"\" style=\"vertical-align: top; font-family: Helvetica, Arial, sans-serif; margin-top: 0px; margin-bottom: 0px; font-size: 19px; line-height: 28px; color: #424651; border-bottom: 1px solid #d3dce0; padding-top: 16px; padding-bottom: 16px; text-align: left;\" width=\"125\">\n<table style=\"width: 516.5px;\">\n<tbody>\n<tr>\n\n</tr>\n</tbody>\n</table>\n<table style=\"max-width: 640px; width: 100%; text-align: center;\" border=\"0\" width=\"640\" cellspacing=\"0\" cellpadding=\"0\" bgcolor=\"#878f95\">\n<tbody>\n<tr>\n<td style=\"padding: 10px; padding-top: 20px; text-align: top;\">\n<table style=\"max-width: 600px; width: 100%; text-align: center;\" border=\"0\" width=\"600\" cellspacing=\"0\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td style=\"color: #ffffff; font-size: 12px; font-weight: 100; line-height: 14px; text-align: center; font-family: sans-serif; padding-bottom: 10px;\" colspan=\"2\"><a style=\"padding-right: 10px;\" href=\"https://www.facebook.com/BankSouth\"><img style=\"margin: 0; padding: 0; border: none;\" src=\"https://banksouth.verticaldemand.com/Portals/4/Images/fb-icon.png\" alt=\"Find us on Facebook\"></a>&nbsp;&nbsp;<a style=\"padding-right: 10px;\" href=\"https://twitter.com/banksouthmtg\"><img style=\"margin: 0; padding: 0; border: none;\" src=\"https://banksouth.verticaldemand.com/Portals/4/Images/twitter-icon.png\" alt=\"Find us on Twitter\"></a>&nbsp;<a href=\"https://www.youtube.com/channel/UCBo7pdLYf-Zu0u53sXp5PZg\"><img style=\"margin: 0; padding: 0; border: none;\" src=\"https://banksouth.verticaldemand.com/Portals/4/Images/youtube-icon.png\" alt=\"Find us on YouTube\"></a></td>\n</tr>\n<tr>\n<td style=\"color: #ffffff; font-size: 13px; font-weight: 100; line-height: 19px; text-decoration: none; text-align: center; font-family: sans-serif; padding-bottom: 5px;\" colspan=\"2\">\n<p>&nbsp;</p>\n<p>3290 Northside Parkway, Suite 600<br>Chicago, IL 30327<br>(888) 555-6999</p>\n</td>\n</tr>\n<tr>\n<td style=\"color: #ffffff; font-size: 10px; font-weight: 100; line-height: 12px; text-align: center; font-family: sans-serif;\" colspan=\"2\">&nbsp;</td>\n</tr>\n</tbody>\n</table>\n</td>\n</tr>\n</tbody>\n</table>\n</td>\n</tr>\n</tbody>\n</table>\n</td>\n</tr>\n</tbody>\n</table>\n</div>",
        "Headers": "",
        "PortalFiles": "",
        "FileToken1": "",
        "IgnoreErros": ""
      },
      "IsEnabled": true,
      "ExecutionType": "OnExecute",
      "Metadata": {}
    },
    {
      "ActionType": "TwilioSendSms",
      "OrderIndex": 18,
      "Condition": "",
      "Parameters": {
        "Credentials": {
          "Type": "twilio.apikeys",
          "Group": "2",
          "EntireGroup": false,
          "Entry": "d5763e2b-6094-464e-a101-e890763b7a6a"
        },
        "FromNumber": "+18032052806",
        "ToNumber": "+1[CFS:BorCellPhone]",
        "SmsBody": "Hi [CFS:FirstName] this is Chicago Financial.  We need the following document reviewed and signed  https://z5portal.com/LOX-Sig?LG=[CFS:LoanGuid]",
        "StatusCallbackUrl": "https://z5portal.com/DesktopModules/DnnSharp/DnnApiEndpoint/Api.ashx?method=AVMMessageStatus",
        "OutputMessageId": "MessageId",
        "IgnoreErrors": "",
        "OnError": []
      },
      "IsEnabled": true,
      "ExecutionType": "OnExecute",
      "Metadata": {}
    }
  ],
  "OnErrorActions": []
}